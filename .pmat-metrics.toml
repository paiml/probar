# O(1) Quality Gate Metric Thresholds for Probar
# Spec: Phase 2 O(1) Quality Gates with hash-based caching
# Pattern: Toyota Way - Jidoka (MEAN mode: warnings = errors)

[thresholds]
# Hard limits (block commits) - based on Probar's testing framework needs
lint_max_ms = 30_000              # 30s (Tier 1 target: sub-second lint-fast)
lint_full_max_ms = 60_000         # 60s (Tier 2 target: full clippy)
test_tier1_max_ms = 10_000        # 10s (Tier 1 target: unit tests)
test_tier2_max_ms = 300_000       # 5min (Tier 2 target: full test suite)
coverage_max_ms = 600_000         # 10min (Tier 2 coverage analysis)
bench_max_ms = 600_000            # 10min (Tier 3 benchmarks)
binary_max_bytes = 10_000_000     # 10MB (WASM testing framework)

# Soft limits (warnings only) - Tier 3 targets
build_release_max_ms = 180_000    # 3min (typical Rust build time)
mutation_test_max_ms = 3_600_000  # 60min (Tier 3 mutation testing)
fuzz_test_max_ms = 600_000        # 10min (Tier 3 fuzzing)

# Browser/WASM-specific thresholds
browser_test_max_ms = 120_000     # 2min (CDP browser tests)
wasm_runtime_max_ms = 60_000      # 1min (wasmtime runtime tests)

[staleness]
# Metrics older than this trigger warnings
max_age_days = 7

[enforcement]
# Pre-commit behavior (MEAN mode = strict)
fail_on_stale_metrics = false     # Warn, don't block
fail_on_missing_metrics = false   # Allow commits if no cache
fail_on_threshold_violation = true # Block commits on violations (MEAN mode)

[trend_analysis]
# Track metrics for Kaizen (continuous improvement)
enabled = true
retention_days = 90
alert_on_regression = true
regression_threshold_pct = 10.0   # Alert if >10% slower

# Probar-specific quality gates
[quality_gates]
# EXTREME TDD targets per CLAUDE.md (95% minimum coverage)
min_coverage_pct = 95.0           # Target: ≥95% line coverage (per CLAUDE.md)
min_mutation_score_pct = 80.0     # Target: ≥80% mutation score
max_cyclomatic_complexity = 15    # Target: ≤15 per function
min_tdg_grade = "B+"              # Target: B+ or better (≥85)
max_unsafe_blocks = 50            # Probar should minimize unsafe
max_unwrap_calls = 20             # Target: nearly unwrap-free

# Performance budgets (WASM testing)
[performance]
# Browser automation targets
max_page_load_ms = 5000           # 5s max page load
max_element_wait_ms = 10000       # 10s max element wait
max_screenshot_ms = 2000          # 2s max screenshot capture
max_regression_pct = 5.0          # ≤5% performance regression allowed

# Benchmark performance budgets (PROBAR-SPEC-008)
[benchmark_budgets]
# Fast operations (must stay sub-microsecond)
selector_parsing_ns = 20          # Baseline: 9-10 ns
locator_creation_ns = 30          # Baseline: 14-15 ns
locator_filtering_ns = 50         # Baseline: 27 ns
color_contrast_ns = 100           # Baseline: 27-51 ns

# Medium operations (microsecond range)
yaml_parsing_simple_us = 15       # Baseline: 7.4 µs
yaml_parsing_50_states_us = 500   # Baseline: 233 µs
state_validation_50_us = 150      # Baseline: 72.5 µs
pixel_report_100x100_us = 60      # Baseline: 27.5 µs
ux_registration_500_us = 250      # Baseline: 120 µs

# Slow operations (millisecond range - acceptable)
mutation_gen_large_ms = 3         # Baseline: 1.25 ms (combinatorial)
heatmap_render_large_ms = 2       # Baseline: 1.01 ms (pixel processing)

[benchmark_enforcement]
fail_on_regression = true
regression_threshold_pct = 20.0   # Alert if >20% slower than baseline
baseline_date = "2025-12-14"      # Baseline established date
